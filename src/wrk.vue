<template>
    <div class="today">
      <div class="section-description">Today</div>
  
      <div class="today-card">
        <div class="weather-informations">
          <div class="date w-full text-center text-sm sm:w-1/4 sm:text-right sm:text-lg md:text-xl">
            {{ isLoading ? 'Loading...' : formattedLocalTime }}
          </div>
          <div class="city w-full text-center text-4xl sm:w-2/4 sm:text-5xl">
            {{ isLoading ? 'Loading...' : weatherData.location.name }}
          </div>
          <div class="country w-full text-center text-sm sm:w-1/4 sm:text-lg md:text-xl">
            {{ isLoading ? 'Loading...' : weatherData.location.country }}
          </div>
          <button class="fav-btn" @click="addToFavorites" v-if="!isFavorite">
            <svg
              class="h-full text-white transition-all duration-300 ease-in-out hover:scale-125"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 384 512"
            >
              <path
                d="M0 48V487.7C0 501.1 10.9 512 24.3 512c5 0 9.9-1.5 14-4.4L192 400 345.7 507.6c4.1 2.9 9 4.4 14 4.4c13.4 0 24.3-10.9 24.3-24.3V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48z"
              />
            </svg>
          </button>
        </div>
        <div class="weather-details">
          <div class="temperature details">
            <div class="details-left">
              <svg class="todaydata-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path
                  d="M416 64a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm0 128A96 96 0 1 0 416 0a96 96 0 1 0 0 192zM96 112c0-26.5 21.5-48 48-48s48 21.5 48 48V276.5c0 17.3 7.1 31.9 15.3 42.5C217.8 332.6 224 349.5 224 368c0 44.2-35.8 80-80 80s-80-35.8-80-80c0-18.5 6.2-35.4 16.7-48.9C88.9 308.4 96 293.8 96 276.5V112zM144 0C82.1 0 32 50.2 32 112V276.5c0 .1-.1 .3-.2 .6c-.2 .6-.8 1.6-1.7 2.8C11.2 304.2 0 334.8 0 368c0 79.5 64.5 144 144 144s144-64.5 144-144c0-33.2-11.2-63.8-30.1-88.1c-.9-1.2-1.5-2.2-1.7-2.8c-.1-.3-.2-.5-.2-.6V112C256 50.2 205.9 0 144 0zm0 416c26.5 0 48-21.5 48-48c0-20.9-13.4-38.7-32-45.3V112c0-8.8-7.2-16-16-16s-16 7.2-16 16V322.7c-18.6 6.6-32 24.4-32 45.3c0 26.5 21.5 48 48 48z"
                />
              </svg>
            </div>
            <div class="details-right">
              <div class="details-title">Temperature</div>
              <div class="details-content">
                {{ isLoading ? 'Loading...' : `${weatherData.current.feelslike_c} Â°C` }}
              </div>
            </div>
          </div>
  
          <div class="current-condition details">
            <div class="details-left">
              <img
                class="h-12"
                :src="isLoading ? '' : weatherData.current.condition.icon"
                :alt="isLoading ? '' : weatherData.current.condition.text"
              />
            </div>
            <div class="details-right">
              <div class="details-title">Current Condition</div>
              <div class="details-content">
                <div>
                  {{ isLoading ? 'Loading...' : weatherData.current.condition.text }}
                </div>
              </div>
            </div>
          </div>
  
          <div class="wind-speed details">
            <div class="details-left">
              <!-- <svg class="todaydata-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path
                  d="M288 32c0 17.7 14.3 32 32 32h32c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32 14.3-32 32s14.3 32 32 32H352c53 0 96-43 96-96s-43-96-96-96H320c-17.7 0-32 14.3-32 32zm64 352c0 17.7 14.3 32 32 32h32c53 0 96-43 96-96s-43-96-96-96H32c-17.7 0-32 14.3-32 32s14.3 32 32 32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H384c-17.7 0-32 14.3-32 32zM128 512h32c53 0 96-43 96-96s-43-96-96-96H32c-17.7 0-32 14.3-32 32s14.3 32 32 32H160c17.7 0 32 14.3 32 32s-14.3 32-32 32H128c-17.7 0-32 14.3-32 32s14.3 32 32 32z"
                />
              </svg> -->
              <svg class="todaydata-icon" width='30' height='30' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><rect width='24' height='24' stroke='none' fill='#000000' opacity='0'/>
  
  
  <g transform="matrix(0.53 0 0 0.53 12 12)" >
  <path style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" translate(-24, -24)" d="M 10 5.9726562 C 9.329258870597734 5.968931848176317 8.701302917253763 6.301652995048398 8.32769716246171 6.858722356487883 C 7.954091407669658 7.415791717927369 7.8845785092036085 8.123039904819958 8.1425781 8.7421875 C 8.1425781 8.7421875 9 11.038188 9 13 C 9 15.547338 8.4277344 16.732531 7.6777344 18.394531 C 6.9277344 20.056531 6 22.194932 6 25.433594 C 6 28.516031 6.7764321 30.496737 7.4023438 32.007812 C 7.8238621 33.025442 8.1610212 33.857514 8.3457031 35.021484 C 7.975188786721085 34.67410876338616 7.486403739870959 34.48068976114863 6.9785156 34.480469 C 6.16502545232824 34.481476614107166 5.433180612692373 34.97506334914394 5.127438435097407 35.72891277474874 C 4.821696257502441 36.482762200353555 5.0029691838769015 37.34668630608828 5.5859375 37.914062 L 8.9082031 41.236328 C 9.287463884078912 41.73558412472294 9.878878680834616 42.0281208049994 10.5058500239292 42.02658608948977 C 11.132821367023784 42.02505137398014 11.722796928452812 41.72962285801517 12.099609000000001 41.228516 L 15.414062 37.914062 C 15.93654358958578 37.4124288537257 16.147013270005946 36.667528015563704 15.96429962196812 35.96664389695504 C 15.781585973930293 35.26575977834637 15.234240221653629 34.71841402606971 14.533356103044964 34.53570037803188 C 13.8324719844363 34.35298672999406 13.0875711462743 34.56345641041422 12.585938 35.085938 L 12.404297 35.267578 C 12.181675 33.172942 11.59371 31.674134 11.097656 30.476562 C 10.473568 28.969888 10 27.917157 10 25.433594 C 10 22.886256 10.572266 21.701064 11.322266 20.039062 C 12.072266 18.377063 13 16.238662 13 13 C 13 9.969812 11.857422 7.2578125 11.857422 7.2578125 C 11.562533064929177 6.487391912057436 10.824917092624696 5.977033030883568 9.999999999999998 5.9726562 z M 25 5.9726562 C 24.329258852915498 5.9689318144651065 23.70130286859567 6.3016529475836185 23.327697089976688 6.858722314558997 C 22.954091311357708 7.415791681534376 22.88457840214374 8.123039888403337 23.142578 8.7421875 C 23.142578 8.7421875 24 11.038188 24 13 C 24 15.547338 23.427734 16.732531 22.677734 18.394531 C 21.927734 20.056531 21 22.194932 21 25.433594 C 21 28.516031 21.776432 30.496737 22.402344 32.007812 C 22.823862 33.025442 23.161021 33.857514 23.345703 35.021484 C 22.975188812750805 34.674108881434485 22.486403967134272 34.48068988809178 21.978515999999996 34.480469 C 21.165025870540457 34.48147665470345 20.43318106808401 34.975063404561524 20.127438916168853 35.72891282098259 C 19.821696764253694 36.48276223740367 20.002969696841884 37.34668631880715 20.585938 37.914062 L 23.908203 41.236328 C 24.287463780987068 41.73558416370276 24.878878601766427 42.02812087117767 25.505849974030223 42.02658615564472 C 26.132821346294023 42.02505144011178 26.722796931658582 41.72962289692158 27.099609 41.228516 L 30.414062 37.914062 C 30.936543589585757 37.4124288537257 31.1470132700059 36.66752801556371 30.96429962196807 35.96664389695506 C 30.781585973930238 35.265759778346414 30.234240221653586 34.71841402606976 29.533356103044937 34.53570037803193 C 28.83247198443629 34.3529867299941 28.087571146274303 34.56345641041425 27.585938 35.085938 L 27.404297 35.267578 C 27.181675 33.172942 26.59371 31.674134 26.097656 30.476562 C 25.473568 28.969888 25 27.917157 25 25.433594 C 25 22.886256 25.572266 21.701064 26.322266 20.039062 C 27.072266 18.377063 28 16.238662 28 13 C 28 9.969812 26.857422 7.2578125 26.857422 7.2578125 C 26.562533064929177 6.487391912057436 25.8249170926247 5.977033030883568 25 5.9726562 z M 35.5 6 C 34.959046125133646 5.992349565681768 34.45587795314258 6.2765629442539925 34.18316841777021 6.743809274571492 C 33.91045888239785 7.211055604888992 33.91045888239785 7.788944395111007 34.18316841777021 8.256190725428507 C 34.45587795314258 8.723437055746007 34.95904612513364 9.007650434318231 35.5 9 L 38.5 9 C 39.346499 9 40 9.6535009 40 10.5 L 40 14 L 38.5 14 C 37.959046125133646 13.992349565681769 37.45587795314258 14.276562944253993 37.18316841777021 14.743809274571493 C 36.91045888239785 15.211055604888992 36.91045888239785 15.788944395111006 37.18316841777021 16.256190725428507 C 37.45587795314258 16.723437055746007 37.95904612513364 17.007650434318233 38.5 17 L 40 17 L 40 22.5 L 38.5 22.5 C 37.959046125133646 22.492349565681767 37.45587795314258 22.776562944253993 37.18316841777021 23.243809274571493 C 36.91045888239785 23.711055604888994 36.91045888239785 24.288944395111006 37.18316841777021 24.756190725428507 C 37.45587795314258 25.223437055746007 37.95904612513364 25.507650434318233 38.5 25.5 L 40 25.5 L 40 31 L 38.5 31 C 37.959046125133646 30.992349565681767 37.45587795314258 31.276562944253993 37.18316841777021 31.743809274571493 C 36.91045888239785 32.21105560488899 36.91045888239785 32.78894439511101 37.18316841777021 33.25619072542851 C 37.45587795314258 33.723437055746004 37.95904612513364 34.00765043431823 38.5 34 L 40 34 L 40 37.5 C 40 38.346499 39.346499 39 38.5 39 L 35.5 39 C 34.959046125133646 38.99234956568177 34.45587795314258 39.27656294425399 34.18316841777021 39.74380927457149 C 33.91045888239785 40.21105560488899 33.91045888239785 40.78894439511101 34.18316841777021 41.25619072542851 C 34.45587795314258 41.723437055746004 34.95904612513364 42.00765043431823 35.5 42 L 38.5 42 C 40.967501 42 43 39.967501 43 37.5 L 43 32.746094 C 43.02645171407677 32.585063711844406 43.02645171407677 32.42079628815559 43 32.259766 L 43 24.246094 C 43.02645171407677 24.085063711844406 43.02645171407677 23.920796288155593 43 23.759766 L 43 15.746094 C 43.02645171407677 15.585063711844406 43.02645171407677 15.420796288155595 43 15.259766 L 43 10.5 C 43 8.0324991 40.967501 6 38.5 6 L 35.5 6 z" stroke-linecap="round" />
  </g>
  </svg>
            </div>
            <div class="details-right">
              <div class="details-title">Pressure</div>
              <div class="details-content">
                {{ isLoading ? 'Loading...' : `${weatherData.current.wind_kph} mb` }}
              </div>
            </div>
          </div>
  
          <div class="humidity details">
            <div class="details-left">
              <svg class="todaydata-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                <path
                  d="M269.5 69.9c11.1-7.9 25.9-7.9 37 0C329 85.4 356.5 96 384 96c26.9 0 55.4-10.8 77.4-26.1l0 0c11.9-8.5 28.1-7.8 39.2 1.7c14.4 11.9 32.5 21 50.6 25.2c17.2 4 27.9 21.2 23.9 38.4s-21.2 27.9-38.4 23.9c-24.5-5.7-44.9-16.5-58.2-25C449.5 149.7 417 160 384 160c-31.9 0-60.6-9.9-80.4-18.9c-5.8-2.7-11.1-5.3-15.6-7.7c-4.5 2.4-9.7 5.1-15.6 7.7c-19.8 9-48.5 18.9-80.4 18.9c-33 0-65.5-10.3-94.5-25.8c-13.4 8.4-33.7 19.3-58.2 25c-17.2 4-34.4-6.7-38.4-23.9s6.7-34.4 23.9-38.4C42.8 92.6 61 83.5 75.3 71.6c11.1-9.5 27.3-10.1 39.2-1.7l0 0C136.7 85.2 165.1 96 192 96c27.5 0 55-10.6 77.5-26.1zm37 288C329 373.4 356.5 384 384 384c26.9 0 55.4-10.8 77.4-26.1l0 0c11.9-8.5 28.1-7.8 39.2 1.7c14.4 11.9 32.5 21 50.6 25.2c17.2 4 27.9 21.2 23.9 38.4s-21.2 27.9-38.4 23.9c-24.5-5.7-44.9-16.5-58.2-25C449.5 437.7 417 448 384 448c-31.9 0-60.6-9.9-80.4-18.9c-5.8-2.7-11.1-5.3-15.6-7.7c-4.5 2.4-9.7 5.1-15.6 7.7c-19.8 9-48.5 18.9-80.4 18.9c-33 0-65.5-10.3-94.5-25.8c-13.4 8.4-33.7 19.3-58.2 25c-17.2 4-34.4-6.7-38.4-23.9s6.7-34.4 23.9-38.4c18.1-4.2 36.2-13.3 50.6-25.2c11.1-9.4 27.3-10.1 39.2-1.7l0 0C136.7 373.2 165.1 384 192 384c27.5 0 55-10.6 77.5-26.1c11.1-7.9 25.9-7.9 37 0zm0-144C329 229.4 356.5 240 384 240c26.9 0 55.4-10.8 77.4-26.1l0 0c11.9-8.5 28.1-7.8 39.2 1.7c14.4 11.9 32.5 21 50.6 25.2c17.2 4 27.9 21.2 23.9 38.4s-21.2 27.9-38.4 23.9c-24.5-5.7-44.9-16.5-58.2-25C449.5 293.7 417 304 384 304c-31.9 0-60.6-9.9-80.4-18.9c-5.8-2.7-11.1-5.3-15.6-7.7c-4.5 2.4-9.7 5.1-15.6 7.7c-19.8 9-48.5 18.9-80.4 18.9c-33 0-65.5-10.3-94.5-25.8c-13.4 8.4-33.7 19.3-58.2 25c-17.2 4-34.4-6.7-38.4-23.9s6.7-34.4 23.9-38.4c18.1-4.2 36.2-13.3 50.6-25.2c11.1-9.5 27.3-10.1 39.2-1.7l0 0C136.7 229.2 165.1 240 192 240c27.5 0 55-10.6 77.5-26.1c11.1-7.9 25.9-7.9 37 0z"
                />
              </svg>
            </div>
            <div class="details-right">
              <div class="details-title">Humidity</div>
              <div class="details-content">
                {{ isLoading ? 'Loading...' : `${weatherData.current.humidity}%` }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </template>
  
  <script setup>
  import { useWeatherStore } from '../stores/WeatherDataStore'
  import { computed } from 'vue'
  import { storeToRefs } from 'pinia'
  
  const { weatherData, isLoading, favorites } = storeToRefs(useWeatherStore())
  
  const formattedLocalTime = computed(() => {
    const localTime = new Date(weatherData.value.location.localtime)
  
    const options = {
      day: 'numeric',
      month: 'long',
      weekday: 'long'
    }
  
    const formatter = new Intl.DateTimeFormat('en-US', options)
    const formattedDate = formatter.format(localTime)
  
    const parts = formattedDate.split(', ')
    const weekday = parts[0]
    const month = parts[1]
  
    return `${month} - ${weekday}`
  })
  
  // Favorites
  
  const weatherStore = useWeatherStore()
  
  const addToFavorites = () => {
    const { name: city, country } = weatherData.value.location
    const favorite = { city, country, weatherData: weatherData.value }
    weatherStore.addToFavorite(favorite)
  }
  
  const isFavorite = computed(() => {
    const cityName = weatherData.value?.location?.name
    return favorites.value.some((favorite) => favorite.city === cityName)
  })
  </script>
  
  <style scoped>
  @tailwind utilities;
  
  @layer utilities {
    .today {
      @apply mb-12;
    }
  
    .today-card {
      @apply flex flex-col;
    }
    .weather-informations {
      @apply relative flex flex-col items-center justify-center gap-5 bg-gray-800 p-4 text-white sm:h-40 sm:flex-row sm:gap-0;
    }
  
    .fav-btn {
      @apply absolute right-6 top-6 h-5;
    }
  
    .weather-details {
      @apply flex flex-wrap;
    }
  
    .details {
      @apply flex h-[120px] w-full items-center justify-center bg-gray-800 py-4 sm:w-[calc(50%-12px)];
    }
  
    .details-left {
      @apply flex w-1/2 items-center justify-center sm:w-1/3;
    }
  
    .todaydata-icon {
      @apply h-8 text-white;
    }
  
    .details-right {
      @apply flex w-1/2 flex-col justify-center gap-2 sm:w-2/3;
    }
  
    .details-title {
      @apply font-medium;
    }
  
    .details-content {
      @apply text-xl sm:text-2xl md:text-3xl;
    }
  }
  </style>
  